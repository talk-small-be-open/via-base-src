- name: Ensure PHP is running
  service:
    name: php7.2-fpm
    state: started

- name: Ensure nginx is running
  service:
    name: nginx
    state: started

- name: Ensure monit is running
  service:
    name: monit
    state: started
    use: sysvinit

- name: Wait for port 2812 to become open (Monit)
  wait_for:
    port: 2812
    sleep: 3
    timeout: 90
    
- name: Ensure GemStone stone is running
  shell: monit start via_gemstone_stone

- name: Ensure GemStone LDI is running
  shell: monit start via_gemstone_netldi

- name: Ensure all GemStone gems are is running
  shell: monit -g via_gemstone_gems start


# Include site specific tasks
- include_tasks: "site/tasks_{{instanceName}}.yml"
